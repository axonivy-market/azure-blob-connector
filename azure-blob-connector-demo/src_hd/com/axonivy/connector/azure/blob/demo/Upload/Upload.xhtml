
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
	<ui:composition template="/layouts/frame-10-full-width.xhtml">
		<ui:define name="title">UploadDialog</ui:define>
		<ui:define name="content">

			<h:form id="form" enctype="multipart/form-data">
				<p:growl id="growl" showDetail="false" />

				<p:fieldset id="uploadWithPrimefaces" legend="Upload by Primefaces">

					<div class="grid">
						<div class="col-2">
							<p:outputLabel for="fileUploader" value="Upload File" />
						</div>

						<div class="col-4">
							<p:fileUpload id="fileUploader" auto="true"
								required="#{empty data.bean.fileName}" dragDropSupport="false"
								listener="#{logic.uploadFileHandle}" mode="simple"
								label="Choose" update="uploadWithPrimefaces" />
							<br />
							<p:outputLabel rendered="#{not empty data.bean.fileName}"
								value="#{data.bean.fileName}" styleClass="w-full" />
						</div>

						<div class="col-6">
							<p:commandButton id="addBlob" process="uploadWithPrimefaces"
								actionListener="#{logic.addBlob}" styleClass="margin-top-15px"
								icon="fa fa-plus" value="Add file"
								update="blobTable growl existFilePanel" />
						</div>

						<div class="col-2">
							<p:outputLabel value="Upload to folder" />
						</div>

						<div class="col-4">
							<p:inputText value="#{data.bean.uploadToFolderByPrimefaces}"
								placeholder="h1 or h1/h2" styleClass="w-full" />
						</div>

						<div class="col-6">
							<h:panelGroup id="existFilePanel">
								<h:outputText
									value="The following file already exist: #{data.bean.fileName}"
									rendered="#{data.bean.isFileAlreadyExist}"
									styleClass="text-red-500" />
							</h:panelGroup>
						</div>

						<div class="col-2" />

						<div class="col-10">
							<p:selectBooleanCheckbox value="#{data.bean.isOverwriteFile}"
								itemLabel="Overwrite if files already exist">
								<p:ajax update="existFilePanel"
									listener="#{logic.overwriteFile}" />
							</p:selectBooleanCheckbox>
						</div>
					</div>

				</p:fieldset>

				<p:fieldset id="uploadByLocalPath" styleClass="mt-2"
					legend="Upload by local path">

					<div class="grid">
						<div class="col-2">
							<p:outputLabel for="inputPath" value="Upload File" />
						</div>

						<div class="col-4">
							<p:inputText id="inputPath" required="true"
								value="#{data.bean.localPath}"
								placeholder="C:\yourFolder\yourPicture.png" styleClass="w-full" />
						</div>

						<div class="col-6">
							<p:commandButton id="addBlobByLocalPath"
								process="uploadByLocalPath"
								actionListener="#{logic.addBlobByLocalPath}" icon="fa fa-plus"
								value="Add file" update="blobTable growl existFilePanelPath" />
						</div>

						<div class="col-2">
							<p:outputLabel value="Upload to folder" />
						</div>
						<div class="col-4">
							<p:inputText value="#{data.bean.uploadToFolderByLocalPath}"
								placeholder="h1 or h1/h2" styleClass="w-full" />
						</div>

						<div class="col-6">
							<h:panelGroup id="existFilePanelPath">
								<h:outputText
									value="The following file already exist: #{data.bean.fileNamePath}"
									rendered="#{data.bean.isFileAlreadyExistPath}"
									styleClass="text-red-500" />
							</h:panelGroup>
						</div>

						<div class="col-2" />

						<div class="col-10">
							<p:selectBooleanCheckbox value="#{data.bean.isOverwriteFilePath}"
								itemLabel="Overwrite if files already exist">
								<p:ajax update="existFilePanelPath"
									listener="#{logic.overwriteFilePath}" />
							</p:selectBooleanCheckbox>
						</div>
					</div>

				</p:fieldset>

				<p:fieldset id="uploadByURL" styleClass="mt-2"
					legend="Upload by URL">

					<div class="grid">
						<div class="col-2">
							<p:outputLabel for="inputUrl" value="Upload File" />
						</div>
						<div class="col-4">
							<p:inputText id="inputUrl" required="true"
								value="#{data.bean.url}" styleClass="w-full" />
						</div>
						<div class="col-6">
							<p:commandButton id="addBlobByURL" process="uploadByURL"
								actionListener="#{logic.addBlobByURL}" icon="fa fa-plus"
								value="Add file" update="blobTable growl existFilePanelURL" />
						</div>

						<div class="col-2">
							<p:outputLabel value="Upload to folder" />
						</div>
						<div class="col-4">
							<p:inputText value="#{data.bean.uploadToFolderByURL}"
								placeholder="h1 or h1/h2" styleClass="w-full" />
						</div>
						<div class="col-6">
							<h:panelGroup id="existFilePanelURL">
								<h:outputText
									value="The following file already exist: #{data.bean.fileNameURL}"
									rendered="#{data.bean.isFileAlreadyExistURL}"
									styleClass="text-red-500" />
							</h:panelGroup>
						</div>

						<div class="col-2" />
						<div class="col-10">
							<p:selectBooleanCheckbox value="#{data.bean.isOverwriteFileURL}"
								itemLabel="Overwrite if files already exist">
								<p:ajax update="existFilePanelURL"
									listener="#{logic.overwriteFileURL}" />
							</p:selectBooleanCheckbox>
						</div>
					</div>

				</p:fieldset>

				<p:fieldset id="deleteBlobs" legend="Delete blob" styleClass="mt-2">
					<div class="formgroup-inline">
						<div class="field">
							<p:outputLabel for="basic" value="Date" />
							<p:datePicker id="basic" required="true"
								value="#{data.bean.startDate}" />
						</div>

						<p:commandButton id="deleteBlob" process="deleteBlobs"
							actionListener="#{logic.deleteBlobs}" icon="fa fa-trash"
							value="Delete blob" update="blobTable growl" />
					</div>
				</p:fieldset>

				<p:dataTable id="blobTable" value="#{data.bean.blobs}" var="blob"
					resizableColumns="true">

					<p:column id="name" headerText="Name">
						<h:outputText value="#{blob.blobItem.name}" id="blobName" />
					</p:column>

					<p:column id="status" headerText="Status">
						<h:outputText
							value="#{blob.blobItem.deleted eq 'true' ? 'Deleted' : 'Current version'}"
							id="statusName" />
					</p:column>

					<p:column id="createDate" headerText="Creation Date">
						<h:outputText value="#{blob.blobItem.properties.creationTime}" />
					</p:column>

					<p:column id="actions">

						<p:commandButton id="btnDownloadBlob" process="@this"
							actionListener="#{logic.downloadFile(blob)}" update="form:growl"
							title="Download" rendered="#{!blob.blobItem.deleted}"
							icon="fa-solid fa-download">
							<p:fileDownload value="#{data.fileContent}" />
						</p:commandButton>

						<p:commandButton id="btnDownloadBlobToFile" process="@this"
							actionListener="#{logic.selectBlob(blob)}"
							oncomplete="PF('downloadToFileDialog').show();"
							title="Download to file" update="form:growl downloadToFileDialog"
							rendered="#{!blob.blobItem.deleted}"
							icon="fa-solid fa-file-arrow-down">
						</p:commandButton>

						<p:commandButton id="btnGetLink" process="@this"
							actionListener="#{logic.getLink(blob)}"
							oncomplete="PF('linkDownloadDialog').show();"
							icon="fa-solid fa-link" rendered="#{!blob.blobItem.deleted}"
							update="linkDownloadDialog" title="Get download link" />

						<p:commandButton id="btnDeleteBlob" process="@this"
							actionListener="#{logic.deleteBlob(blob.blobItem.name)}"
							update="blobTable form:growl" icon="fa fa-trash"
							rendered="#{!blob.blobItem.deleted}" title="Delete a blob" />

						<p:commandButton id="btnUnDeleteBlob" value="Undelete"
							process="@this"
							actionListener="#{logic.unDeleteBlob(blob.blobItem.name)}"
							update="blobTable form:growl" icon="fa fa-undo"
							rendered="#{blob.blobItem.deleted}" title="Restore a blob" />
					</p:column>

				</p:dataTable>
			</h:form>

			<p:dialog widgetVar="linkDownloadDialog" id="linkDownloadDialog"
				appendTo="@(body)" visible="false" header="Link Download"
				closeOnEscape="true" width="500">

				<div class="flex">
					<div class="w-9">
						<p:inputText id="link" value="#{data.blob.linkDownLoad}"
							styleClass="w-full" />
					</div>
					<div class="w-3">
						<p:commandButton id="btnCopy" value="Copy" icon="pi pi-copy"
							styleClass="ml-2" />
						<pe:clipboard id="clipCopy" trigger="btnCopy" action="copy"
							target="link">
							<p:ajax event="success" listener="#{logic.showCopiedMessage}"
								update="form:growl" />
						</pe:clipboard>
					</div>
				</div>
			</p:dialog>

			<p:dialog widgetVar="downloadToFileDialog" id="downloadToFileDialog"
				appendTo="@(body)" visible="false" header="Path to save"
				closeOnEscape="true" width="500">

				<p:ajax event="close" update="downloadToFileDialog"
					resetValues="true" />

				<h:form id="downloadToFile">
					<div class="flex">
						<div class="w-2">
							<p:outputLabel for="pathToSave" value="Path" />
						</div>
						<div class="w-8">
							<p:inputText id="pathToSave" value="#{data.filePath}"
								required="true" placeholder="C:\yourFolder\fileNameToSave"
								styleClass="w-full" />
						</div>
						<div class="w-2">
							<p:commandButton id="btnSaveToPath" value="OK"
								actionListener="#{logic.downloadToFile}"
								oncomplete="if (!args.validationFailed) {PF('downloadToFileDialog').hide()}"
								update="form:growl pathToSave" process="downloadToFile"
								styleClass="ml-2" />
						</div>
					</div>
				</h:form>
			</p:dialog>

		</ui:define>
	</ui:composition>
</h:body>

</html>


